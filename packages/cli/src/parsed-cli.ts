import {BrowserSafeApis} from '@remotion/renderer/client';
import minimist from 'minimist';
import type {CommandLineOptions} from './parse-command-line';

export const BooleanFlags = [
	'overwrite',
	'force',
	'sequence',
	'help',
	'quiet',
	'q',
	'muted',
	BrowserSafeApis.options.enforceAudioOption.cliFlag,
	// Lambda flags
	'force',
	'disable-chunk-optimization',
	'save-browser-logs',
	'disable-cloudwatch',
	'enable-lambda-insights',
	'yes',
	'y',
	BrowserSafeApis.options.disableWebSecurityOption.cliFlag,
	BrowserSafeApis.options.darkModeOption.cliFlag,
	BrowserSafeApis.options.ignoreCertificateErrorsOption.cliFlag,
	'disable-headless',
	BrowserSafeApis.options.keyboardShortcutsOption.cliFlag,
	BrowserSafeApis.options.experimentalClientSideRenderingOption.cliFlag,
	'default-only',
	'no-open',
	BrowserSafeApis.options.ipv4Option.cliFlag,
	BrowserSafeApis.options.beepOnFinishOption.cliFlag,
	BrowserSafeApis.options.disableGitSourceOption.cliFlag,
	BrowserSafeApis.options.disallowParallelEncodingOption.cliFlag,
	BrowserSafeApis.options.forSeamlessAacConcatenationOption.cliFlag,
	'repro',
	'compatible-only',
	'force-path-style',
	'onlyAllocateCpuDuringRequestProcessing',
	BrowserSafeApis.options.isProductionOption.cliFlag,
	BrowserSafeApis.options.forceNewStudioOption.cliFlag,
];

export const parsedCli = minimist<CommandLineOptions>(process.argv.slice(2), {
	boolean: BooleanFlags,
	default: {
		overwrite: true,
		muted: null,
	},
}) as CommandLineOptions & {
	_: string[];
};

export const quietFlagProvided = () => parsedCli.quiet || parsedCli.q;
